# Code Review: Backend Project Analysis

> **–î–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞:** 12 —è–Ω–≤–∞—Ä—è 2026
> **–ü—Ä–æ–µ–∫—Ç:** med-vito-rest-api (NestJS Backend)

## –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ

1. [Developer Experience (DX)](#1-developer-experience-dx)
2. [–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å](#2-–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å)
3. [–§–∞–π–ª–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞](#3-—Ñ–∞–π–ª–æ–≤–∞—è-—Å—Ç—Ä—É–∫—Ç—É—Ä–∞)
4. [–ü–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç—å —Ä–µ—à–µ–Ω–∏–π](#4-–ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç—å-—Ä–µ—à–µ–Ω–∏–π)
5. [–ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö](#5-–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ-–±–∞–∑—ã-–¥–∞–Ω–Ω—ã—Ö)
6. [Separation of Concerns](#6-separation-of-concerns)
7. [–¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å](#7-—Ç–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å)
8. [–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å](#8-–º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å)

---

## 1. Developer Experience (DX)

### üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

#### 1.1 –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ç–µ—Å—Ç–æ–≤

```
# –ü–æ–∏—Å–∫ —Ç–µ—Å—Ç–æ–≤ –≤ –ø—Ä–æ–µ–∫—Ç–µ:
**/*.spec.ts ‚Üí –ù–µ –Ω–∞–π–¥–µ–Ω–æ
**/*.test.ts ‚Üí –ù–µ –Ω–∞–π–¥–µ–Ω–æ
```

- –ù–µ—Ç unit-—Ç–µ—Å—Ç–æ–≤
- –ù–µ—Ç integration-—Ç–µ—Å—Ç–æ–≤
- –ù–µ—Ç e2e —Ç–µ—Å—Ç–æ–≤ (–ø–∞–ø–∫–∞ test –ø—É—Å—Ç–∞—è)
- –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏—Ç—å –∫–æ–¥

#### 1.2 –°–ª–∞–±–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è TypeScript

–í `tsconfig.json`:

```json
{
  "noImplicitAny": false, // ‚ùå –ü–æ–∑–≤–æ–ª—è–µ—Ç –Ω–µ—è–≤–Ω—ã–π any
  "strictBindCallApply": false, // ‚ùå –û—Ç–∫–ª—é—á–µ–Ω–∞ —Å—Ç—Ä–æ–≥–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
  "noFallthroughCasesInSwitch": false // ‚ùå –ú–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –±–∞–≥–∞–º
}
```

#### 1.3 –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏—è —Å—Ö–µ–º—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

```typescript
// app.module.ts
ConfigModule.forRoot({
  isGlobal: true,
  // ‚ùå –ù–µ—Ç validationSchema (Joi/Zod)
  // ‚ùå –ù–µ—Ç envFilePath –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏–π
});
```

### üü° –°—Ä–µ–¥–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

#### 1.5 –ù–µ–∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ã–µ –∏–º–µ–Ω–æ–≤–∞–Ω–∏—è

- `createProductDto` ‚Üí –Ω–∞—Ä—É—à–∞–µ—Ç PascalCase –¥–ª—è –∫–ª–∞—Å—Å–æ–≤
- `SignUpDto` vs `createProductDto` ‚Äî —Ä–∞–∑–Ω—ã–π —Å—Ç–∏–ª—å
- `mailerSerivce` ‚Üí –æ–ø–µ—á–∞—Ç–∫–∞ –≤ –Ω–∞–∑–≤–∞–Ω–∏–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π
- `SubcategotyType` ‚Üí –æ–ø–µ—á–∞—Ç–∫–∞ –≤ –Ω–∞–∑–≤–∞–Ω–∏–∏ –º–æ–¥–µ–ª–∏ (Subcategoty vs Subcategory)

#### 1.6 –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

- `README.md` –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π –ø–æ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ
- –ù–µ—Ç JSDoc/TSDoc –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –≤ —Å–µ—Ä–≤–∏—Å–∞—Ö
- –ù–µ—Ç –æ–ø–∏—Å–∞–Ω–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –ø—Ä–æ–µ–∫—Ç–∞

---

## 2. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

#### 2.3 –ù–µ—Ç rate limiting

```typescript
// –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç @nestjs/throttler –∏–ª–∏ –∞–Ω–∞–ª–æ–≥
// ‚ùå –ù–µ—Ç –∑–∞—â–∏—Ç—ã –æ—Ç brute-force –∞—Ç–∞–∫ –Ω–∞ login/signup
// ‚ùå –ù–µ—Ç –∑–∞—â–∏—Ç—ã –æ—Ç DDoS
```

#### 2.5 –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏—è –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞

```typescript
// sign-up.dto.ts
@IsString({ message: '–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Å—Ç—Ä–æ–∫–æ–π' })
@IsNotEmpty({ message: '–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è' })
phoneNumber: string;
// ‚ùå –ù–µ—Ç @Matches –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
// ‚ùå –ú–æ–∂–Ω–æ –≤–≤–µ—Å—Ç–∏ –ª—é–±—É—é —Å—Ç—Ä–æ–∫—É
```

#### 2.6 SQL Injection –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª —á–µ—Ä–µ–∑ Prisma

```typescript
// statistics.service.ts - raw —Å—Ç—Ä–æ–∫–∏ –≤ where —É—Å–ª–æ–≤–∏—è—Ö
...(query.region && {
  address: {
    contains: query.region,  // ‚ùå –ù–µ —Å–∞–Ω–∏—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω
    mode: 'insensitive' as const,
  },
}),
```

### üü° –°—Ä–µ–¥–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

#### 2.8 Cookie –±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —Ñ–ª–∞–≥–æ–≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

```typescript
// auth.service.ts
response.cookie('session_id', sessionId, {
  httpOnly: true,
  secure: process.env.NODE_ENV === 'production',
  sameSite: process.env.NODE_ENV === 'production' ? 'strict' : 'lax',
  // ‚ùå –ù–µ—Ç path, domain
});
```

#### 2.9 –ù–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∑–∞–≥—Ä—É–∂–∞–µ–º—ã—Ö —Ñ–∞–π–ª–æ–≤

```typescript
// product.controller.ts
@UseInterceptors(FilesInterceptor('images', 8))
// ‚ùå –ù–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞
// ‚ùå –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ MIME type
// ‚ùå –ú–æ–∂–Ω–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å –≤—Ä–µ–¥–æ–Ω–æ—Å–Ω—ã–π —Ñ–∞–π–ª
```

---

## 3. –§–∞–π–ª–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

### üü° –°—Ä–µ–¥–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

#### 3.1 –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Å–ª–æ—ë–≤

```
src/
‚îú‚îÄ‚îÄ auth/           # ‚ùå –°–º–µ—à–∞–Ω—ã controller, service, dto, guards
‚îú‚îÄ‚îÄ product/        # ‚ùå –ù–µ—Ç –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ —Å–ª–æ—è repository
‚îú‚îÄ‚îÄ user/           # ‚ùå –ù–µ—Ç –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ —Å–ª–æ—è domain/entity
```

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:**

```
src/
‚îú‚îÄ‚îÄ modules/
‚îÇ   ‚îú‚îÄ‚îÄ auth/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ application/    # Use cases
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ domain/         # Entities, Value Objects
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ infrastructure/ # Repositories, Guards
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ presentation/   # Controllers, DTOs
```

#### 3.2 –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç shared –º–æ–¥—É–ª–∏

- `common/utils/` —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–æ–ª—å–∫–æ id-generator
- –ù–µ—Ç shared exceptions, filters, interceptors
- –ù–µ—Ç —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ error handling

#### 3.4 SQL dumps –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏

```
dumps/
‚îú‚îÄ‚îÄ dump.sql        # ‚ùå –ù–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤ —Ä–µ–ø–æ
‚îî‚îÄ‚îÄ init-user.sql   # ‚ùå –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è —É—Ç–µ—á–∫–∞ –¥–∞–Ω–Ω—ã—Ö
```

---

## 4. –ü–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç—å —Ä–µ—à–µ–Ω–∏–π

### üü° –°–æ–º–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

#### 4.4 –ù–µ—Ç Helmet –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

```json
// ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –ø–∞–∫–µ—Ç helmet
// –î–æ–ª–∂–µ–Ω –±—ã—Ç—å: "helmet": "^7.x"
```

---

## 5. –ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

#### 5.1 –û–ø–µ—á–∞—Ç–∫–∞ –≤ –Ω–∞–∑–≤–∞–Ω–∏–∏ –º–æ–¥–µ–ª–∏

```prisma
model SubcategotyType {  // ‚ùå "Subcategoty" –≤–º–µ—Å—Ç–æ "Subcategory"
  ...
}
```

#### 5.2 –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

```prisma
model Product {
  userId Int
  categoryId Int
  subCategoryId Int
  // ‚ùå –ù–µ—Ç –∏–Ω–¥–µ–∫—Å–æ–≤ –Ω–∞ —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –ø–æ–ª—è –¥–ª—è –ø–æ–∏—Å–∫–∞
  // @@index([userId])
  // @@index([categoryId])
  // @@index([moderateState])
  // @@index([createdAt])
}

model Message {
  chatId Int
  senderId Int
  // ‚ùå –ù–µ—Ç –∏–Ω–¥–µ–∫—Å–æ–≤
}
```

#### 5.4 –ò–∑–±—ã—Ç–æ—á–Ω—ã–µ —Å–≤—è–∑–∏

```prisma
model Chat {
  lastMessageId Int?
  lastMessage   Message? @relation("LastMessage", fields: [lastMessageId], references: [id])
  // ‚ùå –î–µ–Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –±–µ–∑ –ø—Ä–∏—á–∏–Ω—ã ‚Äî –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å —á–µ—Ä–µ–∑ messages ORDER BY createdAt DESC LIMIT 1
}
```

### üü° –°—Ä–µ–¥–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

#### 5.5 –°–º–µ—à–µ–Ω–∏–µ —è–∑—ã–∫–æ–≤ –≤ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è—Ö

```prisma
// –õ–∏–º–∏—Ç –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –æ–±—ä—è–≤–ª–µ–Ω–∏–π –≤ –º–µ—Å—è—Ü
freeAdsLimit Int @default(12)

// –ß–∞—Ç—ã –≥–¥–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–∫—É–ø–∞—Ç–µ–ª—å
chatsAsBuyer  Chat[]
```

–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–¥–∏–Ω —è–∑—ã–∫ (–∞–Ω–≥–ª–∏–π—Å–∫–∏–π) –¥–ª—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤.

#### 5.6 –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∞—É–¥–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π

```prisma
model User {
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  // ‚ùå –ù–µ—Ç createdBy, updatedBy
}
```

#### 5.7 String –¥–ª—è —Å—Ç–∞—Ç—É—Å–æ–≤ –≤–º–µ—Å—Ç–æ Enum

```prisma
model Payment {
  status String // PENDING, COMPLETED, FAILED
  // ‚ùå –î–æ–ª–∂–µ–Ω –±—ã—Ç—å enum PaymentStatus
}
```

#### 5.8 –ù–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –Ω–∞ —É—Ä–æ–≤–Ω–µ –ë–î

```prisma
model User {
  balance Float @default(0)
  // ‚ùå –ú–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º ‚Äî –Ω–µ—Ç CHECK constraint
}
```

### üî¥ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –ë–î

#### 5.9 –ü–ª–æ—Ö–∞—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

```prisma
model Product {
  images String[] @default([])  // ‚ùå –ú–∞—Å—Å–∏–≤ —Å—Ç—Ä–æ–∫ ‚Äî —Å–ª–æ–∂–Ω–æ —É–ø—Ä–∞–≤–ª—è—Ç—å
  // –õ—É—á—à–µ: –æ—Ç–¥–µ–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ ProductImage
}

model User {
  // –°–º–µ—à–∞–Ω—ã —Ä–∞–∑–Ω—ã–µ –¥–æ–º–µ–Ω—ã –≤ –æ–¥–Ω–æ–π —Ç–∞–±–ª–∏—Ü–µ:
  freeAdsLimit Int @default(12)      // –ë–∏–ª–ª–∏–Ω–≥
  usedFreeAds Int @default(0)        // –ë–∏–ª–ª–∏–Ω–≥
  balance Float @default(0)          // –ë–∏–ª–ª–∏–Ω–≥
  bonusBalance Float @default(0)     // –ë–∏–ª–ª–∏–Ω–≥
  isEmailVerified Boolean            // –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
  isResetVerified Boolean            // –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
  password String                    // –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
  // ‚ùå –ù–∞—Ä—É—à–µ–Ω–∏–µ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–π —Ñ–æ—Ä–º—ã ‚Äî —Å–ª–µ–¥—É–µ—Ç —Ä–∞–∑–¥–µ–ª–∏—Ç—å
}
```

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:**

```prisma
// ‚úÖ –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ –¥–æ–º–µ–Ω—ã:
model User {
  id Int
  fullName String
  email String
  phoneNumber String
  profileType ProfileType
}

model UserAuth {
  userId Int @unique
  user User @relation(...)
  password String
  isEmailVerified Boolean
  isResetVerified Boolean
}

model UserBilling {
  userId Int @unique
  user User @relation(...)
  balance Float
  bonusBalance Float
  freeAdsLimit Int
  usedFreeAds Int
}
```

#### 5.10 –ü—Ä–æ–±–ª–µ–º—ã —Å —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å—é –∏ constraints

```prisma
model PhoneNumberView {
  @@unique([viewedById, viewedUserId])
  // ‚ùå –ú–æ–∂–Ω–æ —Å–º–æ—Ç—Ä–µ—Ç—å –æ–¥–∏–Ω –Ω–æ–º–µ—Ä –º–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω–æ (—Ä–∞–∑–Ω—ã–µ timestamp)
  // –ù–æ unique constraint –∑–∞–ø—Ä–µ—â–∞–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –∑–∞–ø–∏—Å–∏
  // –ö–æ–Ω—Ñ–ª–∏–∫—Ç –ª–æ–≥–∏–∫–∏!
}

model Review {
  @@unique([reviewedById, reviewedUserId])
  // ‚ùå –ú–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –û–î–ò–ù –æ—Ç–∑—ã–≤ –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  // –ê —á—Ç–æ –µ—Å–ª–∏ –ª–æ–≥–∏–∫–∞ –∏–∑–º–µ–Ω–∏—Ç—Å—è?
}

model ProductFieldValue {
  @@unique([fieldId, productId])
  // ‚úÖ –≠—Ç–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ ‚Äî –æ–¥–Ω–æ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ–ª—è –Ω–∞ —Ç–æ–≤–∞—Ä
}
```

#### 5.11 –ò–∑–±—ã—Ç–æ—á–Ω–∞—è –¥–µ–Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è

```prisma
model Chat {
  // –î–µ–Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Å—á—ë—Ç—á–∏–∫–∏:
  unreadCountBuyer  Int @default(0)
  unreadCountSeller Int @default(0)

  // –î–µ–Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –ø–æ—Å–ª–µ–¥–Ω–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ:
  lastMessageId Int?
  lastMessage Message? @relation("LastMessage", ...)
  lastMessageAt DateTime @default(now())

  // ‚ùå –ü—Ä–æ–±–ª–µ–º—ã:
  // 1. –ù—É–∂–Ω–æ –æ–±–Ω–æ–≤–ª—è—Ç—å –ø—Ä–∏ –∫–∞–∂–¥–æ–º —Å–æ–æ–±—â–µ–Ω–∏–∏ (3 –∑–∞–ø–∏—Å–∏ –≤–º–µ—Å—Ç–æ 1)
  // 2. –†–∏—Å–∫ —Ä–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
  // 3. –°–ª–æ–∂–Ω–µ–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö
}
```

**–ü—Ä–æ–±–ª–µ–º—ã —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏:**

- –ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å `Chat.lastMessageId`
- –ü—Ä–∏ –ø—Ä–æ—á—Ç–µ–Ω–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å `Chat.unreadCount*`
- –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –Ω—É–∂–Ω–æ –ø–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å lastMessage
- –†–∏—Å–∫ race conditions –ø—Ä–∏ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö

#### 5.12 –ù–µ–æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ –æ—Ç–Ω–æ—à–µ–Ω–∏—è Many-to-Many

```prisma
model User {
  favorites Product[] @relation("UserFavorites")
}

model Product {
  favoritedBy User[] @relation("UserFavorites")

  // ‚ùå –ù–µ—è–≤–Ω–∞—è –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ _UserFavorites
  // ‚ùå –ù–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –¥–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ (–∫–æ–≥–¥–∞ –¥–æ–±–∞–≤–ª–µ–Ω–æ, —Ç–µ–≥–∏ –∏ —Ç.–¥.)
}

// ‚úÖ –õ—É—á—à–µ —è–≤–Ω–∞—è —Å–≤—è–∑—É—é—â–∞—è —Ç–∞–±–ª–∏—Ü–∞:
model Favorite {
  id Int @id @default(autoincrement())
  userId Int
  user User @relation(...)
  productId Int
  product Product @relation(...)
  addedAt DateTime @default(now())
  tags String[]  // –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è

  @@unique([userId, productId])
  @@index([userId])
  @@index([productId])
}
```

#### 5.13 –ü—Ä–æ–±–ª–µ–º—ã —Å –∫–∞—Å–∫–∞–¥–Ω—ã–º —É–¥–∞–ª–µ–Ω–∏–µ–º

```prisma
model User {
  products Product[]  // onDelete: Cascade
  chatsAsBuyer Chat[] @relation("BuyerChats")  // onDelete: Cascade
  chatsAsSeller Chat[] @relation("SellerChats")  // onDelete: Cascade
  sentMessages Message[]  // onDelete: Cascade

  // ‚ùå –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
  // 1. –£–¥–∞–ª—è—é—Ç—Å—è –≤—Å–µ –µ–≥–æ —Ç–æ–≤–∞—Ä—ã
  // 2. –£–¥–∞–ª—è—é—Ç—Å—è –≤—Å–µ —á–∞—Ç—ã (–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –¥—Ä—É–≥–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π!)
  // 3. –¢–µ—Ä—è–µ—Ç—Å—è –∏—Å—Ç–æ—Ä–∏—è –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
}

model Product {
  userId Int
  user User @relation(..., onDelete: Cascade)

  // ‚ùå –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —É–¥–∞–ª—è—é—Ç—Å—è –≤—Å–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è
  // –õ—É—á—à–µ: onDelete: SetNull + isDeleted: true
}
```

#### 5.14 –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

```prisma
model Payment {
  amount Float  // ‚ùå –ù–µ—Ç –∏—Å—Ç–æ—Ä–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π
  status String // ‚ùå –ù–µ—Ç –ª–æ–≥–∞ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ —Å—Ç–∞—Ç—É—Å–æ–≤

  // ‚úÖ –î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
  // model PaymentStatusHistory {
  //   id Int
  //   paymentId Int
  //   status PaymentStatus
  //   changedAt DateTime
  //   changedBy Int?
  //   reason String?
  // }
}

model Product {
  price Int  // ‚ùå –ù–µ—Ç –∏—Å—Ç–æ—Ä–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π —Ü–µ–Ω—ã
  // –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ü–µ–Ω—ã ‚Äî —Ç–µ—Ä—è–µ—Ç—Å—è —Å—Ç–∞—Ä–∞—è
}
```

#### 5.15 –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è

```prisma
model Message {
  id Int @id @default(autoincrement())
  createdAt DateTime @default(now())

  // ‚ùå –û–¥–Ω–∞ –±–æ–ª—å—à–∞—è —Ç–∞–±–ª–∏—Ü–∞ –¥–ª—è –≤—Å–µ—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
  // –ü—Ä–∏ –º–∏–ª–ª–∏–æ–Ω–∞—Ö –∑–∞–ø–∏—Å–µ–π:
  // - –ú–µ–¥–ª–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
  // - –ë–æ–ª—å—à–æ–π —Ä–∞–∑–º–µ—Ä –∏–Ω–¥–µ–∫—Å–æ–≤
  // - –°–ª–æ–∂–Ω—ã–π maintenance

  // ‚úÖ –ù—É–∂–Ω–æ –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ –¥–∞—Ç–µ:
  // - messages_2025_01
  // - messages_2025_02
  // - messages_2025_03
}

model ProductView {
  viewedAt DateTime @default(now())
  // ‚ùå –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ ‚Äî –Ω—É–∂–Ω–æ –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–ª–∏ archiving
}
```

#### 5.16 –ü—Ä–æ–±–ª–µ–º—ã —Å —Ç–∏–ø–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö

```prisma
model User {
  id Int @id  // ‚ùå autoincrement –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
  // –í–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è —Ä–∞–Ω–¥–æ–º–Ω—ã–π 7-–∑–Ω–∞—á–Ω—ã–π ID
  // –ü—Ä–æ–±–ª–µ–º—ã:
  // - –ù–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –¥–ª—è –∏–Ω–¥–µ–∫—Å–æ–≤ (–Ω–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–π)
  // - –ö–æ–ª–ª–∏–∑–∏–∏ –ø—Ä–∏ –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ
  // - –ü—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ—Å—Ç—å (security issue)
}

model Product {
  price Int  // ‚ùå –í –∫–æ–ø–µ–π–∫–∞—Ö –∏–ª–∏ —Ä—É–±–ª—è—Ö? –ù–µ—Ç –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
  // –õ—É—á—à–µ: Decimal –∏–ª–∏ Money type
}

model User {
  balance Float @default(0)  // ‚ùå Float –¥–ª—è –¥–µ–Ω–µ–≥!
  bonusBalance Float @default(0)  // ‚ùå –ü—Ä–æ–±–ª–µ–º—ã —Å —Ç–æ—á–Ω–æ—Å—Ç—å—é
  // 0.1 + 0.2 ‚â† 0.3 –≤ Float!
  // ‚úÖ –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: Decimal
}

model Log {
  action String  // ‚ùå –ù–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–∞—è –¥–ª–∏–Ω–∞
  // –ú–æ–∂–µ—Ç –≤—ã—Ä–∞—Å—Ç–∏ –¥–æ –≥–∏–≥–∞–±–∞–π—Ç–æ–≤
  // ‚úÖ –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: @db.VarChar(10000) –∏–ª–∏ –æ—Ç–¥–µ–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞
}
```

#### 5.17 –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –ø–æ–∏—Å–∫–∞

```prisma
model Product {
  name String
  description String?

  // ‚ùå –ù–µ—Ç –∏–Ω–¥–µ–∫—Å–æ–≤ –¥–ª—è –ø–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –ø–æ–∏—Å–∫–∞
  // @@index([name, description]) ‚Äî –Ω–µ –ø–æ–º–æ–∂–µ—Ç –¥–ª—è LIKE %text%

  // ‚úÖ PostgreSQL:
  // - @db.TsVector –¥–ª—è –ø–æ–ª—è search_vector
  // - GIN –∏–Ω–¥–µ–∫—Å –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞
}
```

#### 5.18 –ü—Ä–æ–±–ª–µ–º—ã —Å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏ –∏ race conditions

**–ü—Ä–∏–º–µ—Ä –∏–∑ –∫–æ–¥–∞:**

```typescript
// product.service.ts
// 1. –ß–∏—Ç–∞–µ–º –±–∞–ª–∞–Ω—Å
const user = await this.prisma.user.findUnique({...});

// 2. –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏ –≤—ã—á–∏—Å–ª—è–µ–º
if (user.balance + user.bonusBalance < adCost) {...}

// 3. –û–±–Ω–æ–≤–ª—è–µ–º (–ù–ï –í –¢–†–ê–ù–ó–ê–ö–¶–ò–ò!)
await this.prisma.user.update({
  data: {
    bonusBalance: { decrement: bonusToDeduct },
    balance: { decrement: balanceToDeduct },
  },
});

// ‚ùå Race condition!
// –ï—Å–ª–∏ –¥–≤–∞ –∑–∞–ø—Ä–æ—Å–∞ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ ‚Äî –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å
```

**–ü—Ä–æ–±–ª–µ–º–∞ –≤ —Å—Ö–µ–º–µ:**

```prisma
model User {
  balance Float @default(0)
  // ‚ùå –ù–µ—Ç database-level constraint –¥–ª—è –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
  // ‚úÖ PostgreSQL: CHECK (balance >= 0)
}
```

#### 5.19 –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —à–∞—Ä–¥–∏–Ω–≥–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏

```prisma
// –ü—Ä–∏ —Ä–æ—Å—Ç–µ –¥–æ –º–∏–ª–ª–∏–æ–Ω–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:
// - –û–¥–Ω–∞ –ë–î –Ω–µ —Å–ø—Ä–∞–≤–∏—Ç—Å—è
// - –ù–µ—Ç —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ —à–∞—Ä–¥–∏–Ω–≥–∞
// - –í—Å–µ —Å–≤—è–∑–∏ –∂—ë—Å—Ç–∫–∏–µ (foreign keys)

// ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:
// 1. –ü–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å —à–∞—Ä–¥–∏–Ω–≥ –ø–æ userId/regionId
// 2. –ò–∑–±–µ–≥–∞—Ç—å cross-shard –∑–∞–ø—Ä–æ—Å–æ–≤
// 3. –î–µ–Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ç–∞–º –≥–¥–µ –Ω—É–∂–Ω–æ
```

#### 5.20 –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ read replicas —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏

```prisma
// ‚ùå –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∏–¥—É—Ç –≤ –æ–¥–Ω—É –ë–î
// –ü—Ä–∏ –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ –Ω–∞ —á—Ç–µ–Ω–∏–µ:
// - –ú–µ–¥–ª–µ–Ω–Ω—ã–µ write –æ–ø–µ—Ä–∞—Ü–∏–∏
// - –ö–æ–Ω–∫—É—Ä–µ–Ω—Ü–∏—è –∑–∞ —Ä–µ—Å—É—Ä—Å—ã

// ‚úÖ –ù—É–∂–Ω–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è:
// - Master –¥–ª—è writes
// - Replicas –¥–ª—è reads
// - CQRS –ø–∞—Ç—Ç–µ—Ä–Ω
```

### üìä –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ –ë–î

**–ù–µ–º–µ–¥–ª–µ–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è:**

1. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –∏–Ω–¥–µ–∫—Å—ã –Ω–∞ —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –ø–æ–ª—è
2. ‚úÖ –ò—Å–ø—Ä–∞–≤–∏—Ç—å —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö (Float ‚Üí Decimal –¥–ª—è –¥–µ–Ω–µ–≥)
3. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å CHECK constraints
4. ‚úÖ –Ø–≤–Ω—ã–µ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã –¥–ª—è M2M
5. ‚úÖ Soft delete –≤–º–µ—Å—Ç–æ CASCADE

**–°—Ä–µ–¥–Ω–∏–π —Å—Ä–æ–∫:**

1. ‚úÖ –†–∞–∑–¥–µ–ª–∏—Ç—å User –Ω–∞ –¥–æ–º–µ–Ω—ã (Auth, Billing, Profile)
2. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
3. ‚úÖ –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ç–∞–±–ª–∏—Ü
4. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫
5. ‚úÖ –†–µ–≤—å—é –≤—Å–µ—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

**–î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ:**

1. ‚úÖ –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ —à–∞—Ä–¥–∏–Ω–≥—É
2. ‚úÖ Read replicas —Å—Ç—Ä–∞—Ç–µ–≥–∏—è
3. ‚úÖ Event Sourcing –¥–ª—è –∞—É–¥–∏—Ç–∞
4. ‚úÖ –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å CQRS

---

## 6. Separation of Concerns

### üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

#### 6.1 –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞—Ö

–ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã –¥–æ–ª–∂–Ω—ã —Ç–æ–ª—å–∫–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å HTTP-–∑–∞–ø—Ä–æ—Å—ã –∏ –≤—ã–∑—ã–≤–∞—Ç—å —Å–µ—Ä–≤–∏—Å—ã.

#### 6.2 –°–µ—Ä–≤–∏—Å—ã —Å–ª–∏—à–∫–æ–º "–∂–∏—Ä–Ω—ã–µ"

```typescript
// product.service.ts ‚Äî 1456 —Å—Ç—Ä–æ–∫!
// –°–æ–¥–µ—Ä–∂–∏—Ç:
// - CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏
// - –ú–æ–¥–µ—Ä–∞—Ü–∏—è
// - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
// - –ü–æ–∏—Å–∫
// - –†–∞–±–æ—Ç–∞ —Å S3
// - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ WebSocket
```

**–ù–∞—Ä—É—à–µ–Ω–∏–µ Single Responsibility Principle:**

```typescript
// product.service.ts
constructor(
  private readonly prisma: PrismaService,
  private readonly configService: ConfigService,
  private readonly userService: UserService,
  private readonly s3Service: S3Service,
  private readonly chatService: ChatService,    // ‚ùå –ó–∞—á–µ–º?
  private readonly chatGateway: ChatGateway,    // ‚ùå –ó–∞—á–µ–º?
)
```

#### 6.3 –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞ –≤ guards –∏ —Å–µ—Ä–≤–∏—Å–∞—Ö

```typescript
// –û–¥–Ω–∞ –∏ —Ç–∞ –∂–µ –ª–æ–≥–∏–∫–∞ getSessionData –≤:
// - auth.service.ts
// - chat.service.ts
// - support.service.ts
```

#### 6.4 –°–º–µ—à–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ –≤ –º–æ–¥–µ–ª—è—Ö

```prisma
model User {
  // –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
  password String
  isResetVerified Boolean

  // –ü—Ä–æ—Ñ–∏–ª—å
  fullName String
  photo String?

  // –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
  balance Float
  bonusBalance Float
  freeAdsLimit Int
  usedFreeAds Int

  // ‚ùå –í—Å—ë –≤ –æ–¥–Ω–æ–π –º–æ–¥–µ–ª–∏ ‚Äî God Object
}
```

### üü° –°—Ä–µ–¥–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

#### 6.5 –ù–µ—Ç —Å–ª–æ—è Repository

```typescript
// –ü—Ä—è–º—ã–µ –≤—ã–∑–æ–≤—ã Prisma –≤ —Å–µ—Ä–≤–∏—Å–∞—Ö
const user = await this.prisma.user.findUnique({ where: { id } });
// ‚ùå –ù–µ—Ç –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏ ‚Äî —Å–ª–æ–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∏ –º–µ–Ω—è—Ç—å ORM
```

#### 6.6 –ù–µ—Ç —Å–ª–æ—è Domain

```typescript
// –ù–µ—Ç –¥–æ–º–µ–Ω–Ω—ã—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π —Å –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–æ–π
// –í—Å—è –ª–æ–≥–∏–∫–∞ –≤ —Å–µ—Ä–≤–∏—Å–∞—Ö
```

---

## 7. –¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å

### üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

#### 7.1 –ü–æ–ª–Ω–æ–µ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ç–µ—Å—Ç–æ–≤

- 0% –ø–æ–∫—Ä—ã—Ç–∏–µ –∫–æ–¥–∞
- –ù–µ—Ç CI/CD pipeline –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

#### 7.2 –°–ª–æ–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–∑-–∑–∞:

- **–ü—Ä—è–º–æ–π –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç Prisma** ‚Äî –Ω–µ—Ç —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤
- **–°—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö –º–µ—Ç–æ–¥–æ–≤ –∏ –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π**
- **–ñ—ë—Å—Ç–∫–æ–π —Å–≤—è–∑–∞–Ω–Ω–æ—Å—Ç–∏** —Å–µ—Ä–≤–∏—Å–æ–≤ –º–µ–∂–¥—É —Å–æ–±–æ–π
- **–û—Ç—Å—É—Ç—Å—Ç–≤–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤** –¥–ª—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

#### 7.3 –ü—Ä–∏–º–µ—Ä —Å–ª–æ–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä—É–µ–º–æ–≥–æ –∫–æ–¥–∞

```typescript
// auth.service.ts
export async function generateUniqueId(
  prisma: PrismaClient, // ‚ùå –ü—Ä–∏–Ω–∏–º–∞–µ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –∫–ª–∞—Å—Å, –∞ –Ω–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
  modelName: 'user' | 'product',
): Promise<number> {
  // ‚ùå –°–æ–¥–µ—Ä–∂–∏—Ç –ª–æ–≥–∏–∫—É —Ä–∞–±–æ—Ç—ã —Å –ë–î
}
```

### üü° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

```typescript
// ‚úÖ –ö–∞–∫ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:
interface IUserRepository {
  findById(id: number): Promise<User | null>;
  create(data: CreateUserDto): Promise<User>;
}

export class AuthService {
  constructor(
    @Inject('USER_REPOSITORY')
    private userRepository: IUserRepository, // ‚úÖ –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å
  ) {}
}
```

---

## 8. –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å

### üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

#### 8.1 –°–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è ID —Å –ë–î

```typescript
// id-generator.ts
for (let attempt = 0; attempt < MAX_ATTEMPTS; attempt++) {
  const randomId = Math.floor(Math.random() * (MAX_ID - MIN_ID + 1)) + MIN_ID;
  const exists = await checkIdExists(prisma, modelName, randomId); // ‚ùå –ó–∞–ø—Ä–æ—Å –∫ –ë–î –≤ —Ü–∏–∫–ª–µ
  if (!exists) return randomId;
}
```

–ü—Ä–∏ –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ ‚Äî —É–∑–∫–æ–µ –º–µ—Å—Ç–æ.

#### 8.2 –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –æ—á–µ—Ä–µ–¥—å –∑–∞–¥–∞—á

```typescript
// –°–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ email
await this.mailerSerivce.sendMail({...});
// ‚ùå –ë–ª–æ–∫–∏—Ä—É–µ—Ç request ‚Äî –Ω—É–∂–µ–Ω queue (Bull/Redis)
```

#### 8.3 –ù–µ—Ç pagination –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

```typescript
// user.service.ts
async findAll() {
  const users = await this.prisma.user.findMany({
    // ‚ùå –ù–µ—Ç take/skip ‚Äî –≤–µ—Ä–Ω—ë—Ç –í–°–ï –∑–∞–ø–∏—Å–∏
  });
}
```

#### 8.4 N+1 –ø—Ä–æ–±–ª–µ–º–∞

```typescript
// statistics.service.ts
const breakdown = await Promise.all(
  views.map(async (view) => {
    const product = await this.prisma.product.findUnique({...}); // ‚ùå N+1
  })
);
```

### üü° –°—Ä–µ–¥–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

#### 8.5 –û–¥–∏–Ω Redis –¥–ª—è —Å–µ—Å—Å–∏–π –∏ –∫—ç—à–∞

```typescript
CacheModule.register({
  store: redisStore,
  host: 'redis',
  // ‚ùå –û–¥–Ω–∞ –ë–î –¥–ª—è –≤—Å–µ–≥–æ ‚Äî –ø—Ä–∏ —Ñ–ª—É—à–µ –∫—ç—à–∞ —É–¥–∞–ª—è—Ç—Å—è —Å–µ—Å—Å–∏–∏
});
```

#### 8.6 –ù–µ—Ç health checks

```typescript
// ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç @nestjs/terminus –¥–ª—è:
// - Database health check
// - Redis health check
// - S3 health check
```

#### 8.7 –ù–µ—Ç graceful shutdown

```typescript
// main.ts
await app.listen(process.env.PORT ?? 3000);
// ‚ùå –ù–µ—Ç app.enableShutdownHooks()
// ‚ùå –ù–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ SIGTERM/SIGINT
```

#### 8.8 –ú–æ–Ω–æ–ª–∏—Ç–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

- –í—Å–µ –º–æ–¥—É–ª–∏ –≤ –æ–¥–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏
- –ù–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- –ù–µ—Ç —Å–æ–±—ã—Ç–∏–π–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã (Event Bus)

---

## –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### üî¥ –í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å + —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å)

1. –î–æ–±–∞–≤–∏—Ç—å rate limiting
2. –ò—Å–ø—Ä–∞–≤–∏—Ç—å CORS –ø–æ–ª–∏—Ç–∏–∫—É
3. –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é —Ñ–∞–π–ª–æ–≤ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
4. –£–±—Ä–∞—Ç—å console.log —Å –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
5. –î–æ–±–∞–≤–∏—Ç—å –±–∞–∑–æ–≤—ã–µ —Ç–µ—Å—Ç—ã
6. –ò—Å–ø—Ä–∞–≤–∏—Ç—å –æ–ø–µ—á–∞—Ç–∫–∏ –≤ —Å—Ö–µ–º–µ –ë–î

### üü° –°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (–∫–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞)

1. –í–∫–ª—é—á–∏—Ç—å strict mode –≤ TypeScript
2. –†–∞–∑–¥–µ–ª–∏—Ç—å –±–æ–ª—å—à–∏–µ —Å–µ—Ä–≤–∏—Å—ã –Ω–∞ –º–µ–Ω—å—à–∏–µ
3. –î–æ–±–∞–≤–∏—Ç—å —Å–ª–æ–π Repository
4. –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
5. –£–¥–∞–ª–∏—Ç—å –¥—É–±–ª–∏—Ä—É—é—â–∏–µ—Å—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

### üü¢ –ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (—É–ª—É—á—à–µ–Ω–∏—è)

1. –î–æ–±–∞–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é
2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å ESLint —Å—Ç—Ä–æ–∂–µ
3. –î–æ–±–∞–≤–∏—Ç—å health checks
4. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å graceful shutdown
5. –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É

---

## –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è

| –ü—Ä–æ–±–ª–µ–º–∞          | –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç                         |
| ----------------- | ---------------------------------- |
| Rate Limiting     | `@nestjs/throttler`                |
| –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å      | `helmet`, `express-rate-limit`     |
| –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥–∞ | `@nestjs/config` + Joi/Zod         |
| –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ      | Jest, Supertest, `@nestjs/testing` |
| Health checks     | `@nestjs/terminus`                 |
| –û—á–µ—Ä–µ–¥–∏           | `@nestjs/bull` + Redis             |
| –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ       | `nestjs-pino`, Winston             |
| –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥        | `@opentelemetry/*`                 |
